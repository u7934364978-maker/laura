<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Login - Wild Fitness</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: #1a1a1a;
            color: #0f0;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        .box {
            background: #000;
            border: 2px solid #0f0;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }
        button {
            background: #0f0;
            color: #000;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            font-weight: bold;
            font-size: 14px;
        }
        button:hover {
            background: #0c0;
        }
        input {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            background: #222;
            border: 1px solid #0f0;
            color: #0f0;
            font-family: 'Courier New', monospace;
        }
        pre {
            background: #222;
            padding: 15px;
            overflow-x: auto;
            border-left: 3px solid #0f0;
        }
        .success { color: #0f0; }
        .error { color: #f00; }
        .warning { color: #ff0; }
    </style>
</head>
<body>
    <h1>ğŸ” Test de Login - Wild Fitness Admin</h1>
    
    <div class="box">
        <h2>ğŸ“‹ InformaciÃ³n del Sistema</h2>
        <div id="systemInfo"></div>
    </div>
    
    <div class="box">
        <h2>ğŸ”‘ Credenciales Actuales en localStorage</h2>
        <div id="currentCreds"></div>
        <button onclick="showStoredCreds()">ğŸ” Ver Credenciales</button>
        <button onclick="resetCreds()">ğŸ”„ Reset Credenciales</button>
        <button onclick="clearAll()">ğŸ—‘ï¸ Limpiar Todo</button>
    </div>
    
    <div class="box">
        <h2>ğŸ§ª Probar Login</h2>
        <input type="text" id="testUsername" placeholder="Usuario" value="admin">
        <input type="password" id="testPassword" placeholder="ContraseÃ±a" value="WildFitness2024!">
        <button onclick="testLogin()">âœ… Probar Login</button>
        <pre id="loginResult"></pre>
    </div>
    
    <div class="box">
        <h2>ğŸ“¡ Test de Supabase</h2>
        <button onclick="testSupabase()">ğŸ”¥ Test ConexiÃ³n Supabase</button>
        <pre id="supabaseResult"></pre>
    </div>
    
    <div class="box">
        <h2>ğŸš€ Acceso RÃ¡pido</h2>
        <button onclick="window.location.href='admin.html'">ğŸ” Ir a Admin Panel</button>
        <button onclick="window.location.href='calendari.html'">ğŸ“… Ir a Calendario</button>
    </div>

    <!-- Supabase CDN - v2.39.0 -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.0/dist/umd/supabase.min.js"></script>
    <script src="supabase-config.js"></script>

    <script>
        // Mostrar informaciÃ³n del sistema
        function showSystemInfo() {
            const info = document.getElementById('systemInfo');
            info.innerHTML = `
                <pre class="success">
âœ… URL: ${window.location.href}
âœ… Navegador: ${navigator.userAgent}
âœ… Fecha: ${new Date().toLocaleString()}
âœ… localStorage disponible: ${typeof(Storage) !== "undefined" ? "SÃ­" : "No"}
âœ… Supabase library cargada: ${typeof(supabase) !== "undefined" ? "SÃ­" : "No"}
                </pre>
            `;
        }
        
        // Mostrar credenciales almacenadas
        function showStoredCreds() {
            const stored = localStorage.getItem('wild_fitness_admin_credentials');
            const auth = localStorage.getItem('wild_fitness_admin_auth');
            const result = document.getElementById('currentCreds');
            
            if (!stored) {
                result.innerHTML = '<pre class="warning">âš ï¸ No hay credenciales almacenadas</pre>';
            } else {
                try {
                    const creds = JSON.parse(stored);
                    const password = atob(creds.password); // Decodificar
                    
                    result.innerHTML = `
                        <pre class="success">
âœ… Credenciales encontradas:
   Username: ${creds.username}
   Password: ${password}
   Password (encoded): ${creds.password}
                        </pre>
                    `;
                } catch (e) {
                    result.innerHTML = `<pre class="error">âŒ Error al leer credenciales: ${e.message}</pre>`;
                }
            }
            
            if (auth) {
                try {
                    const authData = JSON.parse(auth);
                    const expires = new Date(authData.expiresAt);
                    const now = new Date();
                    const isValid = expires > now;
                    
                    result.innerHTML += `
                        <pre class="${isValid ? 'success' : 'error'}">
ğŸ“ SesiÃ³n actual:
   Token: ${authData.token.substring(0, 20)}...
   Expira: ${expires.toLocaleString()}
   Estado: ${isValid ? 'âœ… VÃLIDA' : 'âŒ EXPIRADA'}
                        </pre>
                    `;
                } catch (e) {
                    result.innerHTML += `<pre class="error">âŒ Error al leer sesiÃ³n: ${e.message}</pre>`;
                }
            }
        }
        
        // Reset credenciales a default
        function resetCreds() {
            const defaultCreds = {
                username: 'admin',
                password: btoa('WildFitness2024!')
            };
            
            localStorage.setItem('wild_fitness_admin_credentials', JSON.stringify(defaultCreds));
            
            document.getElementById('currentCreds').innerHTML = `
                <pre class="success">
âœ… Credenciales reseteadas a:
   Username: admin
   Password: WildFitness2024!
                </pre>
            `;
        }
        
        // Limpiar todo
        function clearAll() {
            if (confirm('Â¿Seguro que quieres limpiar TODAS las credenciales y sesiones?')) {
                localStorage.removeItem('wild_fitness_admin_credentials');
                localStorage.removeItem('wild_fitness_admin_auth');
                
                document.getElementById('currentCreds').innerHTML = `
                    <pre class="success">âœ… Todo limpiado. Haz clic en "Reset Credenciales" para crear nuevas.</pre>
                `;
            }
        }
        
        // Probar login
        function testLogin() {
            const username = document.getElementById('testUsername').value;
            const password = document.getElementById('testPassword').value;
            const result = document.getElementById('loginResult');
            
            // Obtener credenciales almacenadas
            const storedCreds = localStorage.getItem('wild_fitness_admin_credentials');
            
            if (!storedCreds) {
                result.innerHTML = `
                    <span class="error">âŒ No hay credenciales almacenadas</span>
                    <span class="warning">â†’ Haz clic en "Reset Credenciales" primero</span>
                `;
                return;
            }
            
            try {
                const creds = JSON.parse(storedCreds);
                const isUsernameOk = username === creds.username;
                const isPasswordOk = btoa(password) === creds.password;
                
                result.innerHTML = `
ğŸ§ª TEST DE LOGIN:
-------------------
Usuario ingresado: ${username}
Usuario esperado: ${creds.username}
âœ… Username match: ${isUsernameOk ? 'âœ… SÃ' : 'âŒ NO'}

Password ingresada: ${password}
Password esperada: ${atob(creds.password)}
Password encoded ingresada: ${btoa(password)}
Password encoded esperada: ${creds.password}
âœ… Password match: ${isPasswordOk ? 'âœ… SÃ' : 'âŒ NO'}

-------------------
RESULTADO: ${isUsernameOk && isPasswordOk ? 'âœ… LOGIN EXITOSO' : 'âŒ LOGIN FALLIDO'}
                `;
                
                result.className = isUsernameOk && isPasswordOk ? 'success' : 'error';
                
                // Si el login es exitoso, crear sesiÃ³n
                if (isUsernameOk && isPasswordOk) {
                    const authData = {
                        token: 'test_' + Date.now(),
                        expiresAt: new Date(Date.now() + 24 * 60 * 60 * 1000).toISOString()
                    };
                    localStorage.setItem('wild_fitness_admin_auth', JSON.stringify(authData));
                    
                    result.innerHTML += '\n\nâœ… SesiÃ³n creada. Puedes ir al Admin Panel ahora.';
                }
                
            } catch (e) {
                result.innerHTML = `âŒ Error: ${e.message}`;
                result.className = 'error';
            }
        }
        
        // Test Supabase
        async function testSupabase() {
            const result = document.getElementById('supabaseResult');
            result.innerHTML = 'ğŸ”„ Probando conexiÃ³n a Supabase...';
            
            try {
                const client = initSupabase();
                
                if (!client) {
                    result.innerHTML = 'âŒ No se pudo inicializar Supabase';
                    result.className = 'error';
                    return;
                }
                
                result.innerHTML = 'âœ… Cliente de Supabase inicializado\nğŸ”„ Intentando cargar actividades...';
                
                const activities = await getActivities();
                
                result.innerHTML = `
âœ… CONEXIÃ“N EXITOSA
-------------------
ğŸ“Š Actividades encontradas: ${activities.length}
ğŸ”¥ URL: ${SUPABASE_CONFIG.url}
âœ… Estado: CONECTADO

${activities.length > 0 ? '\nğŸ“‹ Actividades:\n' + activities.map(a => `  - ${a.title} (${a.date})`).join('\n') : '\nâš ï¸ No hay actividades en la base de datos'}
                `;
                result.className = 'success';
                
            } catch (e) {
                result.innerHTML = `âŒ ERROR DE CONEXIÃ“N:\n${e.message}\n\nStack:\n${e.stack}`;
                result.className = 'error';
            }
        }
        
        // Inicializar al cargar
        window.addEventListener('DOMContentLoaded', () => {
            showSystemInfo();
            showStoredCreds();
        });
    </script>
</body>
</html>
