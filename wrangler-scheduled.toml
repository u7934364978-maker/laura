# ============================================
# CLOUDFLARE SCHEDULED WORKER CONFIGURATION
# Wild Fitness - Emails Programados
# ============================================

name = "wild-fitness-scheduled-emails"
main = "scheduled-worker.js"
compatibility_date = "2024-01-20"

# ============================================
# CRON TRIGGERS - Programaci√≥n Autom√°tica
# ============================================

# Ejecutar todos los d√≠as a las 10:00 AM (hora de Espa√±a)
# Env√≠a recordatorios para actividades del d√≠a siguiente
[triggers]
crons = ["0 9 * * *"]
# Formato: "minuto hora d√≠a mes d√≠a_semana"
# 0 9 * * * = Todos los d√≠as a las 9:00 UTC (10:00 AM Espa√±a en invierno)

# Para diferentes horarios:
# "0 8 * * *"  = 8:00 UTC (9:00 AM Espa√±a)
# "0 18 * * *" = 18:00 UTC (7:00 PM Espa√±a)
# "0 9 * * 1"  = 9:00 UTC solo los lunes
# "*/30 * * * *" = Cada 30 minutos

# ============================================
# KV NAMESPACE - Almacenamiento de datos
# ============================================

# Bind para acceder a las actividades almacenadas
[[kv_namespaces]]
binding = "ACTIVITIES_KV"
id = "TU_KV_NAMESPACE_ID"  # Obtener con: wrangler kv:namespace create ACTIVITIES_KV

# ============================================
# VARIABLES SECRETAS
# ============================================

# Configurar con: npx wrangler secret put RESEND_API_KEY
# RESEND_API_KEY = "tu_api_key"

# ============================================
# CONFIGURACI√ìN DEL PROYECTO
# ============================================

# ==================================================
# INSTRUCCIONES DE CONFIGURACI√ìN:
# ==================================================
#
# 1. Crear KV Namespace para almacenar actividades:
#    npx wrangler kv:namespace create ACTIVITIES_KV
#    
#    Esto devolver√° un ID, copiarlo y pegarlo arriba en "id"
#
# 2. Configurar API Key de Resend (si no est√° ya):
#    npx wrangler secret put RESEND_API_KEY
#
# 3. Deploy del worker programado:
#    npx wrangler deploy --config wrangler-scheduled.toml
#
# 4. Verificar que el cron est√° activo:
#    - Ir a Cloudflare Dashboard
#    - Workers & Pages ‚Üí wild-fitness-scheduled-emails
#    - Ver "Triggers" tab
#    - Deber√≠a aparecer el cron schedule
#
# 5. Probar manualmente (opcional):
#    curl -X POST https://wild-fitness-scheduled-emails.tu-usuario.workers.dev/test-reminders
#
# ==================================================
# FUNCIONALIDADES:
# ==================================================
#
# ‚úÖ Recordatorios autom√°ticos 24h antes de actividad
# ‚úÖ Se ejecuta todos los d√≠as a las 10:00 AM
# ‚úÖ Busca actividades del d√≠a siguiente
# ‚úÖ Env√≠a email a cada participante registrado
# ‚úÖ Env√≠a resumen al admin
# ‚úÖ Notifica errores al admin
#
# ==================================================
# COSTOS:
# ==================================================
#
# ‚úÖ Cloudflare Workers: 100% GRATIS
#    - Incluye Cron Triggers sin costo
#    - KV Namespace: 1 GB gratis
#    - Reads: 100,000/d√≠a gratis
#    - Writes: 1,000/d√≠a gratis
#
# ‚úÖ Resend: 3,000 emails/mes gratis
#
# Total: $0 / mes üéâ
#
# ==================================================
# SINCRONIZAR ACTIVIDADES CON KV:
# ==================================================
#
# Las actividades deben sincronizarse desde localStorage
# del navegador al KV de Cloudflare.
#
# Esto se puede hacer:
# 1. Manualmente con wrangler kv:key put
# 2. Con un endpoint API que sincronice autom√°ticamente
# 3. Con un Worker adicional que escuche cambios
#
# Ver: SCHEDULED_EMAIL_SETUP.md para m√°s detalles
#
# ==================================================
